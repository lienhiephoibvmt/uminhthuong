<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiệp Hội Bảo Vệ Môi Trường - Báo Cáo Khảo Sát U Minh Thượng</title>
    <!-- Font Awesome cho icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Chart.js cho biểu đồ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #2E7D32; /* Xanh lá đậm */
            --secondary-color: #4CAF50; /* Xanh lá tươi */
            --bg-color: #F1F8E9; /* Xanh nhạt nền */
            --text-color: #333;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body { background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--shadow);
        }
        header h1 { font-size: 2rem; margin-bottom: 10px; text-transform: uppercase; }
        header p { font-size: 1.1rem; opacity: 0.9; }

        /* Container */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Dashboard Overview */
        .overview-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--secondary-color);
        }

        .card h3 { color: var(--primary-color); font-size: 1.1rem; margin-bottom: 10px; }
        .card .number { font-size: 2.5rem; font-weight: bold; color: var(--text-color); }
        .card .desc { font-size: 0.9rem; color: #666; }

        /* Main Grid: Charts & Details */
        .report-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .report-grid { grid-template-columns: 1fr; }
        }

        .chart-box {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Survey Questions Section */
        .section-title {
            background: var(--primary-color);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 5px;
            margin: 30px 0 20px 0;
            font-size: 1.2rem;
        }

        .question-block {
            background: var(--white);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .question-text { font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        
        .result-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        .result-label { width: 40%; padding-right: 10px; }
        .progress-bg { flex-grow: 1; background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: var(--secondary-color); display: flex; align-items: center; justify-content: flex-end; padding-right: 5px; color: white; font-size: 0.8rem; transition: width 1s ease-in-out; }
        .result-count { width: 50px; text-align: right; font-weight: bold; }

        /* Participant List Table */
        .participant-list {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            max-height: 500px;
            overflow-y: scroll;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: var(--primary-color); color: var(--white); position: sticky; top: 0; }
        tr:hover { background-color: #f1f1f1; }
        
        .tag {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .tag-good { background-color: #e8f5e9; color: #2e7d32; }
        .tag-bad { background-color: #ffebee; color: #c62828; }
        .tag-neutral { background-color: #fff3e0; color: #ef6c00; }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>

    <header>
        <h1><i class="fas fa-leaf"></i> Hiệp Hội Bảo Vệ Môi Trường</h1>
        <p>Báo cáo kết quả khảo sát tình hình môi trường tại U Minh Thượng</p>
    </header>

    <div class="container">
        <!-- Overview -->
        <div class="overview-cards">
            <div class="card">
                <h3>Tổng số phiếu</h3>
                <div class="number">30</div>
                <div class="desc">Người dân ngẫu nhiên</div>
            </div>
            <div class="card">
                <h3>Khu vực</h3>
                <div class="number" style="font-size: 1.5rem">U Minh Thượng</div>
                <div class="desc">Các xã: An Minh Bắc, Minh Thuận...</div>
            </div>
            <div class="card">
                <h3>Độ tuổi phổ biến</h3>
                <div class="number">30 - 50</div>
                <div class="desc">Chiếm đa số (Giả lập)</div>
            </div>
            <div class="card">
                <h3>Xu hướng chính</h3>
                <div class="number" style="font-size: 1.5rem; color: var(--primary-color)">Tích cực</div>
                <div class="desc">Ý thức bảo vệ môi trường cao</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="report-grid">
            <div class="chart-box">
                <h4 style="margin-bottom:15px">Cơ cấu độ tuổi người tham gia</h4>
                <canvas id="ageChart"></canvas>
            </div>
            <div class="chart-box">
                <h4 style="margin-bottom:15px">Mức độ sẵn sàng tham gia BVMT</h4>
                <canvas id="willingnessChart"></canvas>
            </div>
        </div>

        <!-- Detailed Survey Stats -->
        <div id="survey-results">
            <!-- JS will render questions here -->
        </div>

        <!-- Participant List -->
        <div class="section-title"><i class="fas fa-users"></i> Danh sách người dân tham gia khảo sát</div>
        <div class="participant-list">
            <table>
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Họ và Tên</th>
                        <th>Tuổi</th>
                        <th>Giới tính</th>
                        <th>Nghề nghiệp</th>
                        <th>Khu vực (Xã)</th>
                        <th>Ý thức</th>
                    </tr>
                </thead>
                <tbody id="participant-table-body">
                    <!-- JS generated rows -->
                </tbody>
            </table>
        </div>

    </div>

    <footer>
        <p>&copy; 2025 Hiệp Hội Bảo Vệ Môi Trường U Minh Thượng. Dữ liệu được giả lập cho mục đích demo.</p>
    </footer>

    <script>
        // --- CẤU HÌNH DỮ LIỆU GIẢ LẬP ---

        const LOCATIONS = ["Xã An Minh Bắc", "Xã Minh Thuận", "Thị trấn Cạnh Đền", "Xã Thạnh Yên", "Xã Hòa Chánh"];
        const LAST_NAMES = ["Nguyễn", "Trần", "Lê", "Phạm", "Huỳnh", "Phan", "Võ", "Đặng", "Bùi", "Đỗ"];
        const MIDDLE_NAMES_MALE = ["Văn", "Hữu", "Thanh", "Minh", "Quốc", "Chí"];
        const MIDDLE_NAMES_FEMALE = ["Thị", "Ngọc", "Thanh", "Mai", "Kim", "Thu"];
        const FIRST_NAMES_MALE = ["Hùng", "Cường", "Tuấn", "Kiệt", "Dũng", "Nam", "Hải", "Sơn", "Tùng", "Long"];
        const FIRST_NAMES_FEMALE = ["Lan", "Huệ", "Cúc", "Trúc", "Mai", "Hương", "Thảo", "Vy", "Hằng", "Nhung"];
        
        const JOBS = ["Nông nghiệp", "Nông nghiệp", "Nông nghiệp", "Buôn bán", "Công nhân", "Giáo viên", "Cán bộ xã", "Nội trợ"];

        // Helper: Random có trọng số (để chỉnh tỉ lệ câu trả lời)
        function weightedRandom(items, weights) {
            let i;
            for (i = 0; i < weights.length; i++)
                weights[i] += weights[i - 1] || 0;
            var random = Math.random() * weights[weights.length - 1];
            for (i = 0; i < weights.length; i++)
                if (weights[i] > random)
                    return items[i];
            return items[items.length - 1]; // Fallback
        }

        // Helper: Sinh tuổi (Ưu tiên 30-50)
        function generateAge() {
            const rand = Math.random();
            if (rand < 0.6) return Math.floor(Math.random() * (50 - 30 + 1)) + 30; // 60% từ 30-50
            if (rand < 0.8) return Math.floor(Math.random() * (60 - 51 + 1)) + 51; // 20% từ 51-60
            return Math.floor(Math.random() * (29 - 16 + 1)) + 16; // 20% từ 16-29
        }

        // --- CẤU TRÚC CÂU HỎI VÀ TRỌNG SỐ ---
        const QUESTIONS_CONFIG = [
            {
                id: "q_air_quality",
                section: "II. Đánh giá môi trường",
                text: "Chất lượng không khí ở khu vực:",
                options: ["Rất tốt", "Tốt", "Bình thường", "Ô nhiễm"],
                weights: [0.1, 0.4, 0.4, 0.1] // Nghiêng về Tốt/Bình thường
            },
            {
                id: "q_water_source",
                section: "II. Đánh giá môi trường",
                text: "Nguồn nước sử dụng chính:",
                options: ["Nước máy", "Nước giếng", "Nước kênh rạch", "Kết hợp"],
                weights: [0.3, 0.5, 0.1, 0.1] // U Minh Thượng hay dùng nước giếng/máy
            },
            {
                id: "q_trash_method",
                section: "II. Đánh giá môi trường",
                text: "Xử lý rác sinh hoạt:",
                options: ["Xe rác thu gom", "Đốt rác", "Chôn lấp trong vườn", "Vứt xuống kênh"],
                weights: [0.3, 0.5, 0.15, 0.05] // Vùng quê vẫn còn đốt rác nhiều
            },
            {
                id: "q_classify",
                section: "II. Đánh giá môi trường",
                text: "Có phân loại rác không:",
                options: ["Có", "Không"],
                weights: [0.7, 0.3] // Nghiêng về chấp hành
            },
            {
                id: "q_health",
                section: "III. Ảnh hưởng sức khỏe",
                text: "Bệnh thường gặp trong gia đình:",
                options: ["Không có", "Ho/Viêm họng", "Dị ứng da", "Tiêu chảy"],
                weights: [0.5, 0.3, 0.1, 0.1]
            },
            {
                id: "q_awareness",
                section: "IV. Nhận thức",
                text: "Biết tác hại đốt/xả rác:",
                options: ["Biết rõ", "Biết sơ sơ", "Không biết"],
                weights: [0.8, 0.15, 0.05] // Ý thức cao
            },
            {
                id: "q_willingness",
                section: "V. Ý kiến & Đề xuất",
                text: "Sẵn sàng tham gia hoạt động BVMT:",
                options: ["Rất sẵn sàng", "Có thể", "Không quan tâm"],
                weights: [0.6, 0.3, 0.1] // Nghiêng về chấp hành
            }
        ];

        // --- TẠO DỮ LIỆU ---
        let participants = [];
        const TOTAL_PEOPLE = 30;

        function generateData() {
            for(let i=0; i<TOTAL_PEOPLE; i++) {
                // 1. Thông tin cá nhân
                let gender = Math.random() > 0.5 ? "Nam" : "Nữ";
                let lastName = LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)];
                let middleName = gender === "Nam" 
                    ? MIDDLE_NAMES_MALE[Math.floor(Math.random() * MIDDLE_NAMES_MALE.length)] 
                    : MIDDLE_NAMES_FEMALE[Math.floor(Math.random() * MIDDLE_NAMES_FEMALE.length)];
                let firstName = gender === "Nam"
                    ? FIRST_NAMES_MALE[Math.floor(Math.random() * FIRST_NAMES_MALE.length)]
                    : FIRST_NAMES_FEMALE[Math.floor(Math.random() * FIRST_NAMES_FEMALE.length)];
                
                let person = {
                    id: i + 1,
                    name: `${lastName} ${middleName} ${firstName}`,
                    gender: gender,
                    age: generateAge(),
                    job: JOBS[Math.floor(Math.random() * JOBS.length)],
                    location: LOCATIONS[Math.floor(Math.random() * LOCATIONS.length)],
                    answers: {}
                };

                // 2. Tạo câu trả lời
                QUESTIONS_CONFIG.forEach(q => {
                    person.answers[q.id] = weightedRandom(q.options, [...q.weights]);
                });

                participants.push(person);
            }
        }

        // --- HIỂN THỊ DỮ LIỆU ---

        function renderStats() {
            const container = document.getElementById('survey-results');
            
            // Nhóm theo section để hiển thị đẹp hơn
            let currentSection = "";

            QUESTIONS_CONFIG.forEach(q => {
                // Tiêu đề section
                if (q.section !== currentSection) {
                    currentSection = q.section;
                    const sectionHeader = document.createElement('div');
                    sectionHeader.className = 'section-title';
                    sectionHeader.innerText = currentSection;
                    container.appendChild(sectionHeader);
                }

                // Tính toán số lượng
                let counts = {};
                q.options.forEach(opt => counts[opt] = 0);
                participants.forEach(p => {
                    counts[p.answers[q.id]]++;
                });

                // HTML cho câu hỏi
                const block = document.createElement('div');
                block.className = 'question-block';
                
                let html = `<div class="question-text">${q.text}</div>`;
                
                q.options.forEach(opt => {
                    let count = counts[opt];
                    let percent = Math.round((count / TOTAL_PEOPLE) * 100);
                    html += `
                        <div class="result-bar">
                            <div class="result-label">${opt}</div>
                            <div class="progress-bg">
                                <div class="progress-fill" style="width: ${percent}%">${percent}%</div>
                            </div>
                            <div class="result-count">(${count})</div>
                        </div>
                    `;
                });

                block.innerHTML = html;
                container.appendChild(block);
            });
        }

        function renderTable() {
            const tbody = document.getElementById('participant-table-body');
            participants.forEach(p => {
                let awarenessTag = "";
                // Logic đơn giản để gắn tag ý thức dựa trên câu trả lời
                if(p.answers['q_willingness'] === "Rất sẵn sàng") {
                    awarenessTag = '<span class="tag tag-good">Tích cực</span>';
                } else if (p.answers['q_willingness'] === "Không quan tâm") {
                    awarenessTag = '<span class="tag tag-bad">Thờ ơ</span>';
                } else {
                    awarenessTag = '<span class="tag tag-neutral">Bình thường</span>';
                }

                const row = `
                    <tr>
                        <td>${p.id}</td>
                        <td>${p.name}</td>
                        <td>${p.age}</td>
                        <td>${p.gender}</td>
                        <td>${p.job}</td>
                        <td>${p.location}</td>
                        <td>${awarenessTag}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderCharts() {
            // Chart 1: Age Groups
            let ageGroups = { "16-30": 0, "31-50": 0, "Trên 50": 0 };
            participants.forEach(p => {
                if(p.age <= 30) ageGroups["16-30"]++;
                else if(p.age <= 50) ageGroups["31-50"]++;
                else ageGroups["Trên 50"]++;
            });

            new Chart(document.getElementById('ageChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(ageGroups),
                    datasets: [{
                        data: Object.values(ageGroups),
                        backgroundColor: ['#81C784', '#2E7D32', '#A5D6A7']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Chart 2: Willingness
            let willingCounts = {};
            // Lấy options từ config
            let qWilling = QUESTIONS_CONFIG.find(q => q.id === 'q_willingness');
            qWilling.options.forEach(opt => willingCounts[opt] = 0);
            
            participants.forEach(p => {
                willingCounts[p.answers['q_willingness']]++;
            });

            new Chart(document.getElementById('willingnessChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(willingCounts),
                    datasets: [{
                        label: 'Số người',
                        data: Object.values(willingCounts),
                        backgroundColor: ['#4CAF50', '#FFC107', '#E57373']
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // --- CHẠY CHƯƠNG TRÌNH ---
        generateData();
        renderStats();
        renderCharts();
        renderTable();

    </script>
</body>
</html>
